<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Exact Content Generation</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { border: 1px solid #ccc; padding: 15px; margin: 10px 0; }
        .content-display { 
            white-space: pre-line; 
            font-family: 'Courier New', monospace; 
            font-size: 12px; 
            line-height: 1.4;
            background: #f9f9f9;
            padding: 10px;
            border: 1px solid #ddd;
            max-height: 400px;
            overflow-y: auto;
        }
        button { 
            background: #4caf50; 
            color: white; 
            border: none; 
            padding: 10px 20px; 
            margin: 10px 5px; 
            cursor: pointer; 
            border-radius: 5px;
        }
        button:hover { background: #45a049; }
        .status { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        .warning { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        .expected { background: #e2e3e5; color: #383d41; border: 1px solid #d6d8db; }
    </style>
</head>
<body>
    <h1>Test Exact Content Generation</h1>
    <p>This test verifies that the AI generates the EXACT content structure you need, matching the 3rd image template.</p>
    
    <div>
        <button onclick="testChessExample()">Test Chess Inauguration (Like 3rd Image)</button>
        <button onclick="testTeachersDay()">Test Teacher's Day Celebration</button>
        <button onclick="testSportsTournament()">Test Sports Tournament</button>
        <button onclick="downloadExactNFA()">Download Exact NFA</button>
    </div>
    
    <div id="status"></div>
    
    <div class="test-section">
        <h3>Expected Output Structure (Based on 3rd Image):</h3>
        <div class="expected content-display">
Subject: inauguration of chess by panchatantra

Request for approval regarding the inauguration of chess by Panchatantra on 16th August at 10 AM. This event will be held in collaboration with RV University and Bharatiya Vidya Bhavan. The objective is to promote strategic thinking and cultural exchange through chess.

‚Ä¢ The inauguration will feature AVS Murthy, Chancellor of RV University, as the chief guest.
‚Ä¢ The event aims to foster educational partnerships between institutions and enhance community engagement.
‚Ä¢ The event will promote strategic thinking and cultural exchange through chess.

The above proposal is submitted for approval, and the advance amount may kindly be released to the organizing committee to conduct the event smoothly.
        </div>
    </div>
    
    <div class="test-section">
        <h3>Generated Content Analysis:</h3>
        <div id="generated-content" class="content-display">Click a test button to see the generated content...</div>
    </div>
    
    <div class="test-section">
        <h3>Content Quality Check:</h3>
        <div id="quality-check" class="content-display">Click a test button to see the quality analysis...</div>
    </div>

    <script>
        const statusDiv = document.getElementById('status');
        const generatedContentDiv = document.getElementById('generated-content');
        const qualityCheckDiv = document.getElementById('quality-check');
        
        function log(message, type = 'info') {
            statusDiv.innerHTML = `<div class="status ${type}">${message}</div>`;
            console.log(message);
        }
        
        function analyzeContent(content, testName) {
            const analysis = [];
            const lines = content.split('\n').map(line => line.trim()).filter(line => line);
            
            analysis.push(`=== ${testName} Analysis ===`);
            analysis.push("");
            
            // Check 1: Subject line (no "Subject:" prefix)
            const hasSubjectPrefix = lines.some(line => line.startsWith('Subject:'));
            if (hasSubjectPrefix) {
                analysis.push("‚ùå FAIL: Content has 'Subject:' prefix - should be direct subject line");
            } else {
                analysis.push("‚úÖ PASS: Subject line without prefix");
            }
            
            // Check 2: Request paragraph starts correctly
            const hasRequestParagraph = content.includes('Request for approval regarding');
            if (hasRequestParagraph) {
                analysis.push("‚úÖ PASS: Contains request paragraph starting with 'Request for approval regarding'");
                
                // Check if it's specific (not generic)
                const isGeneric = content.includes('NFA generated successfully') || 
                                 content.includes('This proposal requires administrative approval');
                if (isGeneric) {
                    analysis.push("‚ùå FAIL: Request paragraph is generic, not specific to summary");
                } else {
                    analysis.push("‚úÖ PASS: Request paragraph is specific to summary");
                }
            } else {
                analysis.push("‚ùå FAIL: Missing request paragraph with 'Request for approval regarding'");
            }
            
            // Check 3: Bullet points
            const bulletPoints = content.match(/‚Ä¢/g) || [];
            if (bulletPoints.length >= 3) {
                analysis.push(`‚úÖ PASS: Contains ${bulletPoints.length} bullet points with ‚Ä¢ symbol`);
                
                // Check if bullets are specific
                const hasSpecificBullets = content.includes('AVS Murthy') || 
                                         content.includes('Chancellor') || 
                                         content.includes('educational partnerships') ||
                                         content.includes('strategic thinking') ||
                                         content.includes('cultural exchange');
                if (hasSpecificBullets) {
                    analysis.push("‚úÖ PASS: Bullet points contain specific details from summary");
                } else {
                    analysis.push("‚ùå FAIL: Bullet points are generic, not specific");
                }
            } else {
                analysis.push(`‚ùå FAIL: Only ${bulletPoints.length} bullet points found, need at least 3`);
            }
            
            // Check 4: Conclusion
            const hasConclusion = content.includes('The above proposal is submitted for approval');
            if (hasConclusion) {
                analysis.push("‚úÖ PASS: Contains conclusion paragraph");
            } else {
                analysis.push("‚ùå FAIL: Missing conclusion paragraph");
            }
            
            // Check 5: No generic content
            const hasGenericContent = content.includes('NFA generated successfully') || 
                                     content.includes('This proposal requires administrative approval');
            if (hasGenericContent) {
                analysis.push("‚ùå FAIL: Contains generic content instead of specific details");
            } else {
                analysis.push("‚úÖ PASS: No generic content detected");
            }
            
            // Check 6: Specific details from summary
            const hasSpecificDetails = content.includes('16th August') || 
                                     content.includes('10 AM') || 
                                     content.includes('Bharatiya Vidya Bhavan') ||
                                     content.includes('Panchatantra');
            if (hasSpecificDetails) {
                analysis.push("‚úÖ PASS: Contains specific details from summary (dates, times, organizations)");
            } else {
                analysis.push("‚ùå FAIL: Missing specific details from summary");
            }
            
            // Overall assessment
            const passCount = (analysis.join('\n').match(/‚úÖ PASS/g) || []).length;
            const failCount = (analysis.join('\n').match(/‚ùå FAIL/g) || []).length;
            
            analysis.push("");
            analysis.push(`=== OVERALL ASSESSMENT ===`);
            analysis.push(`Passed: ${passCount} requirements`);
            analysis.push(`Failed: ${failCount} requirements`);
            
            if (failCount === 0) {
                analysis.push("üéâ PERFECT: All requirements met!");
            } else if (failCount <= 2) {
                analysis.push("‚ö†Ô∏è GOOD: Most requirements met, minor issues");
            } else {
                analysis.push("‚ùå NEEDS IMPROVEMENT: Multiple requirements failed");
            }
            
            return analysis.join('\n');
        }
        
        async function testChessExample() {
            try {
                log("üîÑ Testing Chess Inauguration example (like 3rd image)...", 'info');
                
                const requestData = {
                    subject: "inauguration of chess by panchatantra",
                    summary: "inauguration of chess by Panchatantra on 16th August at 10 AM. This event will be held in collaboration with RV University and Bharatiya Vidya Bhavan. The objective is to promote strategic thinking and cultural exchange through chess.",
                    nfaType: "advance",
                    bulletsRequired: true,
                    tableData: [
                        ["slno", "item", "unit", "total"],
                        ["1", "prize", "2", "20"],
                        ["2", "prize", "2", "20"],
                        ["3", "prize", "2", "20"],
                        ["Total", "", "", "60"]
                    ]
                };
                
                console.log("üì§ Sending Chess example request:", requestData);
                
                const response = await fetch('http://localhost:5000/api/generate-nfa', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(requestData),
                });
                
                const result = await response.json();
                console.log("üì• Chess example response:", result);
                
                if (result.success) {
                    const content = result.nfaText || "";
                    const analysis = analyzeContent(content, "Chess Inauguration");
                    
                    generatedContentDiv.textContent = content;
                    qualityCheckDiv.textContent = analysis;
                    
                    // Overall assessment
                    const passCount = (analysis.match(/‚úÖ PASS/g) || []).length;
                    const failCount = (analysis.match(/‚ùå FAIL/g) || []).length;
                    
                    if (failCount === 0) {
                        log(`‚úÖ Chess Example PERFECT: ${passCount} requirements met`, 'success');
                    } else if (failCount <= 2) {
                        log(`‚ö†Ô∏è Chess Example GOOD: ${passCount} passed, ${failCount} failed`, 'warning');
                    } else {
                        log(`‚ùå Chess Example NEEDS IMPROVEMENT: ${passCount} passed, ${failCount} failed`, 'error');
                    }
                    
                } else {
                    throw new Error(result.error || "Chess example generation failed");
                }
                
            } catch (error) {
                log(`‚ùå Error testing Chess example: ${error.message}`, 'error');
                generatedContentDiv.textContent = `Error: ${error.message}`;
                qualityCheckDiv.textContent = `Error: ${error.message}`;
            }
        }
        
        async function testTeachersDay() {
            try {
                log("üîÑ Testing Teacher's Day Celebration...", 'info');
                
                const requestData = {
                    subject: "Teacher's Day Celebration",
                    summary: "Teacher's Day Celebration on 5th September 2025 to honor and appreciate our dedicated teaching staff with cultural performances, recognition awards, and special luncheon for 150 participants.",
                    nfaType: "advance",
                    bulletsRequired: true,
                    tableData: [
                        ["slno", "item", "unit", "total"],
                        ["1", "prize", "2", "20"],
                        ["2", "prize", "2", "20"],
                        ["3", "prize", "2", "20"],
                        ["Total", "", "", "60"]
                    ]
                };
                
                const response = await fetch('http://localhost:5000/api/generate-nfa', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(requestData),
                });
                
                const result = await response.json();
                
                if (result.success) {
                    const content = result.nfaText || "";
                    const analysis = analyzeContent(content, "Teacher's Day Celebration");
                    
                    generatedContentDiv.textContent = content;
                    qualityCheckDiv.textContent = analysis;
                    
                    const passCount = (analysis.match(/‚úÖ PASS/g) || []).length;
                    const failCount = (analysis.match(/‚ùå FAIL/g) || []).length;
                    
                    if (failCount === 0) {
                        log(`‚úÖ Teacher's Day PERFECT: ${passCount} requirements met`, 'success');
                    } else if (failCount <= 2) {
                        log(`‚ö†Ô∏è Teacher's Day GOOD: ${passCount} passed, ${failCount} failed`, 'warning');
                    } else {
                        log(`‚ùå Teacher's Day NEEDS IMPROVEMENT: ${passCount} passed, ${failCount} failed`, 'error');
                    }
                    
                } else {
                    throw new Error(result.error || "Teacher's Day generation failed");
                }
                
            } catch (error) {
                log(`‚ùå Error testing Teacher's Day: ${error.message}`, 'error');
                generatedContentDiv.textContent = `Error: ${error.message}`;
                qualityCheckDiv.textContent = `Error: ${error.message}`;
            }
        }
        
        async function testSportsTournament() {
            try {
                log("üîÑ Testing Sports Tournament...", 'info');
                
                const requestData = {
                    subject: "Inter-College Sports Tournament",
                    summary: "Inter-college sports tournament on 15th October 2025 featuring cricket, football, and basketball competitions with 20 participating colleges and prize distribution ceremony.",
                    nfaType: "reimbursement",
                    bulletsRequired: true,
                    tableData: [
                        ["slno", "item", "unit", "total"],
                        ["1", "prize", "2", "20"],
                        ["2", "prize", "2", "20"],
                        ["3", "prize", "2", "20"],
                        ["Total", "", "", "60"]
                    ]
                };
                
                const response = await fetch('http://localhost:5000/api/generate-nfa', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(requestData),
                });
                
                const result = await response.json();
                
                if (result.success) {
                    const content = result.nfaText || "";
                    const analysis = analyzeContent(content, "Sports Tournament");
                    
                    generatedContentDiv.textContent = content;
                    qualityCheckDiv.textContent = analysis;
                    
                    const passCount = (analysis.match(/‚úÖ PASS/g) || []).length;
                    const failCount = (analysis.match(/‚ùå FAIL/g) || []).length;
                    
                    if (failCount === 0) {
                        log(`‚úÖ Sports Tournament PERFECT: ${passCount} requirements met`, 'success');
                    } else if (failCount <= 2) {
                        log(`‚ö†Ô∏è Sports Tournament GOOD: ${passCount} passed, ${failCount} failed`, 'warning');
                    } else {
                        log(`‚ùå Sports Tournament NEEDS IMPROVEMENT: ${passCount} passed, ${failCount} failed`, 'error');
                    }
                    
                } else {
                    throw new Error(result.error || "Sports Tournament generation failed");
                }
                
            } catch (error) {
                log(`‚ùå Error testing Sports Tournament: ${error.message}`, 'error');
                generatedContentDiv.textContent = `Error: ${error.message}`;
                qualityCheckDiv.textContent = `Error: ${error.message}`;
            }
        }
        
        async function downloadExactNFA() {
            try {
                log("üîÑ Downloading exact NFA with perfect content...", 'info');
                
                // First generate content
                const generateRequest = {
                    subject: "inauguration of chess by panchatantra",
                    summary: "inauguration of chess by Panchatantra on 16th August at 10 AM. This event will be held in collaboration with RV University and Bharatiya Vidya Bhavan. The objective is to promote strategic thinking and cultural exchange through chess.",
                    nfaType: "advance",
                    bulletsRequired: true,
                    tableData: [
                        ["slno", "item", "unit", "total"],
                        ["1", "prize", "2", "20"],
                        ["2", "prize", "2", "20"],
                        ["3", "prize", "2", "20"],
                        ["Total", "", "", "60"]
                    ]
                };
                
                const generateResponse = await fetch('http://localhost:5000/api/generate-nfa', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(generateRequest),
                });
                
                const generateResult = await generateResponse.json();
                
                if (!generateResult.success) {
                    throw new Error("Failed to generate content first");
                }
                
                // Analyze the generated content
                const analysis = analyzeContent(generateResult.nfaText, "Chess Inauguration");
                const passCount = (analysis.match(/‚úÖ PASS/g) || []).length;
                const failCount = (analysis.match(/‚ùå FAIL/g) || []).length;
                
                // Now download with the generated content
                const downloadRequest = {
                    editedText: generateResult.nfaText,
                    subject: "inauguration of chess by panchatantra",
                    summary: "inauguration of chess by Panchatantra on 16th August at 10 AM. This event will be held in collaboration with RV University and Bharatiya Vidya Bhavan. The objective is to promote strategic thinking and cultural exchange through chess.",
                    nfaType: "advance",
                    tableData: [
                        ["slno", "item", "unit", "total"],
                        ["1", "prize", "2", "20"],
                        ["2", "prize", "2", "20"],
                        ["3", "prize", "2", "20"],
                        ["Total", "", "", "60"]
                    ]
                };
                
                const downloadResponse = await fetch('http://localhost:5000/api/download-edited-nfa', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(downloadRequest),
                });
                
                const downloadResult = await downloadResponse.json();
                
                if (downloadResult.success) {
                    generatedContentDiv.textContent = `‚úÖ DOCX Generated Successfully!
File: ${downloadResult.fileName}
Path: ${downloadResult.filePath}

Generated Content:
${generateResult.nfaText}`;
                    
                    qualityCheckDiv.textContent = `Content Quality Analysis:
- Passed: ${passCount} requirements
- Failed: ${failCount} requirements

${analysis}

The DOCX contains the exact content structure you need!`;
                    
                    log(`‚úÖ Download successful - Content quality: ${passCount}/${passCount + failCount} requirements met`, 'success');
                    
                    // Provide download link
                    const downloadUrl = `http://localhost:5000${downloadResult.filePath}`;
                    const link = document.createElement('a');
                    link.href = downloadUrl;
                    link.download = downloadResult.fileName;
                    link.textContent = `Download: ${downloadResult.fileName}`;
                    link.style.display = 'block';
                    link.style.marginTop = '10px';
                    link.style.color = '#4caf50';
                    link.style.textDecoration = 'underline';
                    generatedContentDiv.appendChild(link);
                    
                } else {
                    throw new Error(downloadResult.error || "Download failed");
                }
                
            } catch (error) {
                log(`‚ùå Error downloading exact NFA: ${error.message}`, 'error');
                generatedContentDiv.textContent = `Error: ${error.message}`;
                qualityCheckDiv.textContent = `Error: ${error.message}`;
            }
        }
        
        // Auto-run health check on page load
        window.onload = () => {
            setTimeout(() => {
                log("üîÑ Testing server health...", 'info');
                fetch('http://localhost:5000/api/health')
                    .then(response => response.json())
                    .then(result => {
                        log(`‚úÖ Health check: ${JSON.stringify(result)}`, 'success');
                    })
                    .catch(error => {
                        log(`‚ùå Health check failed: ${error.message}`, 'error');
                    });
            }, 1000);
        };
    </script>
</body>
</html>
